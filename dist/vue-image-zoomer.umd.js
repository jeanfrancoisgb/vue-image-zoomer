(function(m,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],o):(m=typeof globalThis<"u"?globalThis:m||self,o(m.VueImageZoomer={},m.Vue))})(this,(function(m,o){"use strict";const c=(i,e)=>{const t=i.__vccOpts||i;for(const[h,s]of e)t[h]=s;return t},d={name:"VueImageZoomer",emits:["onZoom","offZoom","regularLoaded","zoomLoaded","zoomLoading"],directives:{clickOutside:{mounted(i,e){i.clickOutsideEvent=function(t){i==t.target||i.contains(t.target)||e.value(t,i)},document.body.addEventListener("click",i.clickOutsideEvent)},unmounted(i){document.body.removeEventListener("click",i.clickOutsideEvent)}}},data(){return{touch:!1,zoomed:!1,x:0,y:0,touchPosition:0,origX:0,origY:0,offsetLeft:0,offsetTop:0,zoomWidth:0,zoomHeight:0,options:{zoomAmount:0,zoom:!1,zoomWebp:!1},loaded:!1,loading:!1,webp_supported:!1,cx:0,cy:0,showSlot:!0}},props:{regular:String,regularWebp:String,zoom:String,zoomWebp:String,imgClass:{type:String,default:""},alt:String,zoomAmount:{type:Number,default:0},clickZoom:Boolean,hoverMessage:{type:String,default:'<span class="vh--icon">&#9906;</span> Hover to zoom'},touchMessage:{type:String,default:'<span class="vh--icon">&#9906;</span> Tap to zoom'},clickMessage:{type:String,default:'<span class="vh--icon">&#9906;</span> Click to zoom'},closePos:{type:String,default:"top-left"},messagePos:{type:String,default:"bottom"},showMessage:{type:Boolean,default:!0},showMessageTouch:{type:Boolean,default:!0},tapToClose:Boolean,breakpoints:Array,touchZoomPos:{type:Array,default(){return[.5,.5]}},imgWidth:Number,imgHeight:Number,lazyload:Boolean,rightClick:{type:Boolean,default:!0}},watch:{propChanges(){this.get_options()}},computed:{propChanges(){return`${this.breakpoints}|${this.regular}|${this.regularWebp}|${this.zoom}|${this.zoomAmount}|${this.zoomWebp}|${this.lazyload}`}},mounted(){this.check_webp_feature("lossy",(i,e)=>{e&&(this.webp_supported=!0)}),this.get_options(),("ontouchstart"in window||navigator.msMaxTouchPoints)&&(this.touch=!0),this.touchLogic()},created(){window.addEventListener("resize",this.debounce(()=>{this.resize()},500))},unmounted(){window.removeEventListener("resize",this.resize())},methods:{async touchLogic(){await o.nextTick();let i,e,t=!1;this.$refs["vue-hover-zs"].addEventListener("touchstart",h=>{if(this.zoomed){h.cancelable&&h.preventDefault();let s=h.changedTouches[0];i=s.pageX-this.cx,e=s.pageY-this.cy}}),this.$refs["vue-hover-zs"].addEventListener("touchmove",h=>{if(this.zoomed){let s=h.changedTouches[0];this.x=s.pageX-i,this.y=s.pageY-e;const l=Math.max(0,this.zoomWidth-this.origX),r=Math.max(0,this.zoomHeight-this.origY);this.x<=-l&&(this.x=-l),this.x>=0&&(this.x=0),this.y<=-r&&(this.y=-r),this.y>=0&&(this.y=0),this.touchPosition="translate3d("+this.x+"px,"+this.y+"px,0)",t=!0}}),this.$refs["vue-hover-zs"].addEventListener("touchend",h=>{if(this.zoomed){let s=h.changedTouches[0];this.cx=s.pageX-i,this.cy=s.pageY-e,!t&&this.tapToClose&&(this.zoomed=!1,this.$emit("offZoom")),t=!1}})},debounce(i,e){let t;return(...h)=>{const s=this;clearTimeout(t),t=setTimeout(()=>i.apply(s,h),e)}},get_options(){this.options.zoomAmount=this.zoomAmount,this.options.zoom=this.zoom,this.options.zoomWebp=this.zoomWebp,this.zoom||(this.options.zoom=this.regular,this.options.zoomAmount=2),!this.zoomWebp&&this.regularWebp&&(this.options.zoomWebp=this.regularWebp,this.options.zoomAmount=2),this.resize()},resize(){this.zoomed=!1,this.loaded=!1},check_webp_feature(i,e){let t={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"},h=new Image;h.onload=()=>{let s=h.width>0&&h.height>0;e(i,s)},h.onerror=()=>{e(i,!1)},h.src="data:image/webp;base64,"+t[i]},loadImage(i,e){const t=new Image;t.onload=e,t.src=i},loadZoom(){this.offset(),this.options.zoomAmount!=0&&this.touch&&this.mobilePos(),this.loaded?(this.zoomed=!0,this.options.zoomAmount==0&&(this.options.zoomAmount=this.zoomWidth/this.origX)):this.zoomLoad()},zoomLoad(){(!this.clickZoom||this.touch)&&(this.loading=!0,this.$emit("zoomLoading"));let i=this.options.zoom;this.breakpoints&&this.breakpoints.forEach(e=>{window.innerWidth>=e.width&&(e.zoom?i=e.zoom:i=e.regular)}),this.webp_supported&&this.options.zoomWebp&&(i=this.options.zoomWebp,this.breakpoints&&this.breakpoints.forEach(e=>{window.innerWidth>=e.width&&(e.zoomWebp?i=e.zoomWebp:i=e.regularWebp)})),this.loadImage(i,e=>{if(this.options.zoomAmount==0)this.zoomWidth=e.target.width,this.zoomHeight=e.target.height,this.options.zoomAmount=e.target.width/this.origX;else{const t=this.options.zoomAmount;this.zoomWidth=this.origX*t;const h=e.target.height/e.target.width;this.zoomHeight=this.zoomWidth*h}console.log("Zoom Debug:",{original:{width:this.origX,height:this.origY},zoom:{width:this.zoomWidth,height:this.zoomHeight},zoomAmount:this.options.zoomAmount,maxMovement:{x:this.zoomWidth-this.origX,y:this.zoomHeight-this.origY}}),this.loaded=!0,this.loading=!1,this.$emit("zoomLoaded"),(!this.clickZoom||this.touch)&&(this.zoomed=!0,this.mobilePos())})},isZoom(i,e){(e=="hover"&&!this.clickZoom&&!this.touch||e=="click"&&(this.clickZoom||this.touch)||typeof i=="object")&&(this.zoomed=!1,i==!0?(this.loadZoom(),this.$emit("onZoom")):this.$emit("offZoom"))},mobilePos(){const i=Math.max(0,this.zoomWidth-this.origX),e=Math.max(0,this.zoomHeight-this.origY);let t=i*this.touchZoomPos[0],h=e*this.touchZoomPos[1];(this.touchZoomPos[0]>1||this.touchZoomPos[0]<0||this.touchZoomPos[1]>1||this.touchZoomPos[1]<0)&&(t=0,h=0),this.cx=-t,this.cy=-h,this.x=-t,this.y=-h,this.touchPosition="translate3d(-"+t+"px,-"+h+"px,0)"},offset(){this.origX=parseFloat(this.$refs["vue-hover-zs"].offsetWidth),this.origY=parseFloat(this.$refs["vue-hover-zs"].offsetHeight)},mousePos(i){if(this.offsetLeft=window.pageXOffset+this.$refs["vue-hover-zs"].getBoundingClientRect().left,this.offsetTop=window.pageYOffset+this.$refs["vue-hover-zs"].getBoundingClientRect().top,!this.touch&&!this.loading)if(!this.loaded)this.offset(),this.zoomLoad();else{const e=i.pageX-this.offsetLeft,t=i.pageY-this.offsetTop,h=this.zoomWidth/this.origX,s=this.zoomHeight/this.origY,l=Math.max(0,this.zoomWidth-this.origX),r=Math.max(0,this.zoomHeight-this.origY);this.x=Math.max(0,Math.min(e*(h-1),l)),this.y=Math.max(0,Math.min(t*(s-1),r)),console.log("Mouse Debug:",{mouse:{x:e,y:t},factors:{x:h,y:s},max:{x:l,y:r},position:{x:this.x,y:this.y}})}}}},g={class:"vh--outer vh--rel"},u=["srcset","media"],f=["srcset","media"],z=["srcset"],p=["loading","src","alt","width","height"],k={key:0},y=["srcset","media"],w=["srcset","media"],x=["srcset","media"],B=["srcset","media"],b=["src"],W=["src"],_=["src"],A=["innerHTML"],E=["innerHTML"],M=["innerHTML"],C={key:1,class:"vh--loading-o vh--abs vh--flex vh--jc vh--ai"};function L(i,e,t,h,s,l){const r=o.resolveDirective("click-outside");return o.openBlock(),o.createElementBlock(o.Fragment,null,[s.showSlot&&!t.lazyload?o.renderSlot(i.$slots,"default",{key:0}):o.createCommentVNode("",!0),o.withDirectives((o.openBlock(),o.createElementBlock("div",g,[o.createElementVNode("div",{class:o.normalizeClass(["vh--holder vh--rel vh--flex vh--jc",{"vh--no-click":!t.rightClick}]),onMouseenter:e[1]||(e[1]=n=>l.isZoom(!0,"hover")),onMouseleave:e[2]||(e[2]=n=>l.isZoom(!1,"hover")),onMousemove:e[3]||(e[3]=(...n)=>l.mousePos&&l.mousePos(...n)),ref:"vue-hover-zs",onClick:e[4]||(e[4]=n=>l.isZoom(!s.zoomed,"click"))},[o.createElementVNode("picture",{class:o.normalizeClass({"vh--none":s.zoomed})},[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(t.breakpoints,n=>(o.openBlock(),o.createElementBlock(o.Fragment,{key:n.width},[n.regularWebp?(o.openBlock(),o.createElementBlock("source",{key:0,srcset:n.regularWebp,type:"image/webp",media:"(min-width:"+n.width+"px)"},null,8,u)):o.createCommentVNode("",!0),n.regular?(o.openBlock(),o.createElementBlock("source",{key:1,srcset:n.regular,media:"(min-width:"+n.width+"px)"},null,8,f)):o.createCommentVNode("",!0)],64))),128)),t.regularWebp?(o.openBlock(),o.createElementBlock("source",{key:0,srcset:t.regularWebp,type:"image/webp"},null,8,z)):o.createCommentVNode("",!0),o.createElementVNode("img",{loading:t.lazyload?"lazy":"eager",src:t.regular,class:o.normalizeClass(t.imgClass),alt:t.alt,onLoad:e[0]||(e[0]=n=>(i.$emit("regularLoaded"),s.showSlot=!1)),width:t.imgWidth,height:t.imgHeight},null,42,p)],2),s.zoomed?(o.openBlock(),o.createElementBlock("picture",k,[(o.openBlock(!0),o.createElementBlock(o.Fragment,null,o.renderList(t.breakpoints,n=>(o.openBlock(),o.createElementBlock(o.Fragment,{key:n.width},[n.zoomWebp?(o.openBlock(),o.createElementBlock("source",{key:0,srcset:n.zoomWebp,type:"image/webp",media:"(min-width:"+n.width+"px)"},null,8,y)):n.regularWebp?(o.openBlock(),o.createElementBlock("source",{key:1,srcset:n.regularWebp,type:"image/webp",media:"(min-width:"+n.width+"px)"},null,8,w)):o.createCommentVNode("",!0),n.zoom?(o.openBlock(),o.createElementBlock("source",{key:2,srcset:n.zoom,media:"(min-width:"+n.width+"px)"},null,8,x)):n.regular?(o.openBlock(),o.createElementBlock("source",{key:3,srcset:n.regular,media:"(min-width:"+n.width+"px)"},null,8,B)):o.createCommentVNode("",!0)],64))),128)),s.options.zoomWebp?(o.openBlock(),o.createElementBlock("source",{key:0,src:s.options.zoomWebp,type:"image/webp"},null,8,b)):o.createCommentVNode("",!0),s.touch?(o.openBlock(),o.createElementBlock("img",{key:2,src:s.options.zoom,class:"vh--image vh--abs",style:o.normalizeStyle("width:"+s.zoomWidth+"px;transform:"+s.touchPosition)},null,12,_)):(o.openBlock(),o.createElementBlock("img",{key:1,src:s.options.zoom,class:"vh--image vh--abs",style:o.normalizeStyle({width:s.zoomWidth+"px",transform:"translate(-"+s.x+"px,-"+s.y+"px)"})},null,12,W))])):o.createCommentVNode("",!0),o.createVNode(o.Transition,{name:"VueHoverfade"},{default:o.withCtx(()=>[!s.zoomed&&!s.loading&&!t.clickZoom&&!s.touch&&t.showMessage?(o.openBlock(),o.createElementBlock("div",{key:0,class:o.normalizeClass(["vh--message vh--abs vh--flex vh--jc vh--ai","vh--message-"+t.messagePos]),innerHTML:t.hoverMessage},null,10,A)):!s.zoomed&&!s.loading&&!s.touch&&t.showMessage?(o.openBlock(),o.createElementBlock("div",{key:1,class:o.normalizeClass(["vh--message vh--abs vh--flex vh--jc vh--ai","vh--message-"+t.messagePos]),innerHTML:t.clickMessage},null,10,E)):!s.zoomed&&!s.loading&&s.touch&&t.showMessageTouch?(o.openBlock(),o.createElementBlock("div",{key:2,class:o.normalizeClass(["vh--message vh--abs vh--flex vh--jc vh--ai","vh--message-"+t.messagePos]),innerHTML:t.touchMessage},null,10,M)):o.createCommentVNode("",!0)]),_:1})],34),o.createVNode(o.Transition,{name:"VueHoverfade"},{default:o.withCtx(()=>[s.touch&&s.zoomed&&s.loaded&&!t.tapToClose?(o.openBlock(),o.createElementBlock("div",{key:0,class:o.normalizeClass(["vh--close vh--abs vh--flex vh--jc vh--ai","vh--"+t.closePos]),onClick:e[5]||(e[5]=o.withModifiers(n=>(s.zoomed=!1,i.$emit("offZoom")),["stop"])),innerHTML:"×"},null,2)):s.loading?(o.openBlock(),o.createElementBlock("div",C,[...e[6]||(e[6]=[o.createElementVNode("div",{class:"vh--loading",innerHTML:"◠"},null,-1)])])):o.createCommentVNode("",!0)]),_:1})])),[[r,l.isZoom],[o.vShow,!s.showSlot||t.lazyload]])],64)}const a=c(d,[["render",L]]),Z={install:(i,e)=>{i.component("VueImageZoomer",a)}};m.VueImageZoomer=a,m.default=Z,Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
